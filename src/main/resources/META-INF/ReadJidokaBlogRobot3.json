{"id":"ReadJidokaBlogRobot3","robotType":"ROBOT","mainClass":"com.novayre.jidoka.robot.tutorial.ReadJidokaBlogRobot3","actions":["init","createExcel","mi_create_excel","create_excel_apache_poi","escribir_excel","escribir_excel_apache_poi","abrir_excel_ruta_local","abrir_excel_ruta_local_ambos_formatos","leer_excel_ruta_local","leer_excel_ruta_local_ambos_formatos","open_notepad","write_notepad","safe_notepad","extraer_xlsx_url","openBrowser","navigate","extractPost","end"],"conditionalActions":["hasMoreItems"],"fieldLinks":[],"actionDetails":[{"id":"init","implementation":"/**\n     * Initial action 'Init'.\n     *\n     * @throws Exception\n     */\npublic void init() throws Exception {\n    // Initialization of the robot components\n    server = (IJidokaServer<?>) JidokaFactory.getServer();\n    windows = IJidokaRobot.getInstance(this);\n    // Default pause after typing or using the mouse\n    windows.typingPause(PAUSE);\n    windows.mousePause(PAUSE);\n    //va a tomar el nombre del archivo en consola\n    name_input_file = server.getParameters().get(\"excel\");\n    ruta_server_jidoka = server.getCurrentDir() + \"\\\\\" + name_input_file;\n    server.info(\"direccion completa del fichero \" + ruta_server_jidoka);\n}"},{"id":"createExcel","implementation":"public void createExcel() throws Exception {\n    excel1 = IExcel.getExcelInstance(this);\n    String excel_file = Paths.get(server.getCurrentDir(), \"salida.xlsx\").toString();\n    excel1.create(excel_file, EExcelType.XLSX);\n    files.add(excel_file);\n    excel1.setCellValueByRef(new  CellReference(0, 0), \"TÃ­tulo del post\");\n    excel1.setCellValueByRef(new  CellReference(0, 1), \"Subtitulo del post\");\n}"},{"id":"mi_create_excel","implementation":"public void mi_create_excel() throws JidokaException, Exception {\n    String directorio_actual = server.getCurrentDir();\n    server.info(\"El directorio actual es :\" + directorio_actual);\n    String name = String.valueOf(new  Date().getTime()) + \"xlsx\";\n    File file = Paths.get(directorio_actual, name).toFile();\n    server.info(\"el fichero esta en \" + file.getAbsolutePath());\n    server.info(\"dentro de crear excel\");\n    String excelPath = file.getAbsolutePath();\n    excel1 = IExcel.getExcelInstance(this);\n    String excel_file = Paths.get(server.getCurrentDir(), \"out.xlsx\").toString();\n    excel1.create(excel_file, EExcelType.XLSX);\n    if (excel1.createSheet(\"Hoja1\")) {\n        server.info(\"la hoja hoja ha sido creada stisfactoriamente\");\n        System.out.println(\"\");\n    } else {\n        server.info(\"no se creo la hoja en el libro\");\n    }\n    files.add(excel_file);\n}"},{"id":"create_excel_apache_poi","implementation":"public void create_excel_apache_poi() throws JidokaException, FileNotFoundException, IOException {\n    String directorio_actual = server.getCurrentDir();\n    String camino = directorio_actual + \"\\\\\" + \"excel_apache_poi.xlsx\";\n    server.info(\"ruta del fichero \" + camino);\n    file_poi = new  File(camino);\n    out = new  FileOutputStream(file_poi);\n    server.setNumberOfItems(datos_proceasar.length);\n    libro = new  XSSFWorkbook();\n    hoja = libro.createSheet(\"Informacion\");\n    dir = camino;\n}"},{"id":"escribir_excel","implementation":"public void escribir_excel() {\n    server.setNumberOfItems(datos_proceasar.length);\n    server.info(\"editando encabezado\");\n    server.info(\"si esta abierto \" + excel1.isOpen());\n    server.info(\"si es diferente de null \" + excel1.getWorkbook().getSheet(\"Hoja1\") != null);\n    if (excel1.isOpen() && excel1.getWorkbook().getSheet(\"Hoja1\") != null) {\n        server.info(\"dentro del if que me permite escribir en el excel\");\n        Row row = excel1.getSheet().createRow(0);\n        row.createCell(0, CellType.STRING).setCellValue(\"TÃ­tulo\");\n        row.createCell(1, CellType.STRING).setCellValue(\"Autor\");\n        row.createCell(2, CellType.STRING).setCellValue(\"Precio\");\n        row.createCell(3, CellType.STRING).setCellValue(\"Existencia\");\n    }\n}"},{"id":"escribir_excel_apache_poi","implementation":"public void escribir_excel_apache_poi() {\n    int row_id = currentItemIndex;\n    Object[] act = (Object[]) map.get(String.valueOf(row_id + 1));\n    row = hoja.createRow(row_id);\n    int cell_id = 0;\n    for (Object elemento : act) {\n        Cell cell = row.createCell(cell_id++);\n        cell.setCellValue((String) elemento);\n    }\n    server.info(\"contenido de las filas \" + act[0] + \"       \" + act[1] + \"       \" + act[2]);\n}"},{"id":"abrir_excel_ruta_local","implementation":"public void abrir_excel_ruta_local() throws FileNotFoundException, IOException {\n    file_poi_lectura = new  File(ruta_local);\n    in = new  FileInputStream(file_poi_lectura);\n    libro = new  XSSFWorkbook(in);\n    hoja = libro.getSheetAt(0);\n}"},{"id":"abrir_excel_ruta_local_ambos_formatos","implementation":"public void abrir_excel_ruta_local_ambos_formatos() throws FileNotFoundException, IOException, InvalidFormatException {\n    file_poi_lectura = new  File(ruta_server_jidoka);\n    in = new  FileInputStream(file_poi_lectura);\n    libro_ambos_formatos = WorkbookFactory.create(in);\n    hoja_ambos_formatos = libro_ambos_formatos.getSheetAt(0);\n    numberOfItems = hoja_ambos_formatos.getLastRowNum();\n    server.info(\"tenemos \" + numberOfItems + \"  filas para leer del archivo\");\n    server.info(\"Se ha abierto correctamente el documento\");\n}"},{"id":"leer_excel_ruta_local","implementation":"public void leer_excel_ruta_local() throws JidokaException, IOException {\n    int row_id = 0;\n    row = hoja.getRow(row_id++);\n    Iterator<Row> iterar_filas = hoja.iterator();\n    server.info(\"INFORMACION POR COLUMNA\");\n    while (iterar_filas.hasNext()) {\n        row = (XSSFRow) iterar_filas.next();\n        server.info(row.getCell(0) + \"    \" + row.getCell(1) + \"    \" + row.getCell(2) + \"    \" + row.getCell(3) + \"    \" + row.getCell(4) + \"    \" + row.getCell(5) + \"    \" + row.getCell(6) + \"    \" + row.getCell(7) + \"    \" + row.getCell(8) + \"    \" + row.getCell(9) + \"    \" + row.getCell(10) + \"    \" + row.getCell(11) + \"    \" + row.getCell(12) + \"    \" + row.getCell(13) + \"    \" + row.getCell(14));\n        Iterator<Cell> iterar_cell = row.cellIterator();\n        Cell cell;\n        while (iterar_cell.hasNext()) {\n            cell = iterar_cell.next();\n        }\n    }\n    in.close();\n}"},{"id":"leer_excel_ruta_local_ambos_formatos","implementation":"public void leer_excel_ruta_local_ambos_formatos() throws JidokaException, IOException {\n    row_ambos_formatos = hoja_ambos_formatos.getRow(currentItemIndex);\n    server.info(\"primera celda de cada fila \" + row_ambos_formatos.getCell(0));\n    Iterator<Cell> iterar_cell = row_ambos_formatos.cellIterator();\n    Cell cell;\n    while (iterar_cell.hasNext()) {\n        cell = iterar_cell.next();\n    }\n    in.close();\n}"},{"id":"open_notepad","implementation":"public void open_notepad() throws JidokaException, JidokaUnsatisfiedConditionException {\n    windows.keyboard().windows(\"r\").pause().type(\"notepad\").enter().pause();\n    windows.waitCondition(10, 100, \"Wait for notepad to be opened\", null, true, ( i,  c)->windows.getWindow(NOTEPAD_REGEXP) != null);\n    windows.showWindow(windows.getWindow(NOTEPAD_REGEXP).gethWnd(), EShowWindowState.SW_MAXIMIZE);\n    windows.pause();\n}"},{"id":"write_notepad","implementation":"public void write_notepad() throws JidokaException {\n    windows.typeText(String.valueOf(row_ambos_formatos.getCell(0)) + \"  \");\n}"},{"id":"safe_notepad","implementation":"public void safe_notepad() throws Exception {\n    windows.typeText(String.valueOf(row_ambos_formatos.getCell(0)));\n    windows.typeText(windows.keyboardSequence().pressControl().type(\"g\").releaseControl());\n    windows.pause();\n    String name_notpad = \"ejemplo.txt\";\n    String path = Paths.get(server.getCurrentDir(), name_notpad).toFile().getAbsolutePath();\n    windows.typeText(path);\n    windows.typeText(windows.keyboardSequence().typeReturn());\n    windows.pause();\n    windows.typeText(windows.keyboardSequence().typeAltF(4));\n    windows.pause();\n}"},{"id":"extraer_xlsx_url","implementation":"public void extraer_xlsx_url() {\n}"},{"id":"openBrowser","implementation":"public void openBrowser() throws Exception {\n    browser = IWebBrowserSupport.getInstance(this, windows);\n    setBrowser();\n    browser.initBrowser();\n    server.info(\"inicio el browser\");\n}"},{"id":"navigate","implementation":"public void navigate() throws Exception {\n    browser.navigate(HOME_URL);\n    checkJidokaBlogLoaded();\n    By loadMoreButton = By.cssSelector(\".pager_load_more .button_icon .button_label\");\n    while (true) {\n        List<WebElement> currentPagePostLinks = browser.getElements(By.cssSelector(\".post-more\"));\n        numberOfItems += currentPagePostLinks.size();\n        currentPagePostLinks.forEach(( link)->postLinks.add(link.getAttribute(\"href\")));\n        boolean morePosts = windows.waitFor(this).wait(3, \"Waiting for more posts to be loaded\", false, false, ()->browser.existsElement(loadMoreButton));\n        if (!morePosts) {\n            break;\n        }\n        WebElement element = browser.getElement(loadMoreButton);\n        browser.moveTo(element);\n        windows.clickOnCenter();\n        windows.getKeyboard().up(4).pause();\n        browser.clickOnElement(loadMoreButton);\n        windows.pause(5000);\n    }\n    browser.navigate(HOME_URL);\n    server.setNumberOfItems(numberOfItems);\n}"},{"id":"extractPost","implementation":"public void extractPost() throws Exception {\n    String title = browser.getText(By.cssSelector(\"h1.entry-title\"));\n    server.setCurrentItem(currentItemIndex, title);\n    excel.setCellValueByRef(new  CellReference(currentItemIndex, 0), title);\n    WebElement image_element = browser.getElement(By.cssSelector(\"img.wp-post-image\"));\n    String image = URI.create(image_element.getAttribute(HTML.Attribute.SRC.toString())).toASCIIString();\n    File file = File.createTempFile(\"jidoka\", String.format(\"post%s\", image.substring(image.lastIndexOf('.'))));\n    try (InputStream is = new  URL(image).openStream();\n        OutputStream os = new  FileOutputStream(file)) {\n        IOUtils.copy(is, os);\n    } catch (IOException e) {\n        server.error(String.format(\"Error getting image %s\", image), e);\n        server.setCurrentItemResultToWarn(e.getLocalizedMessage());\n        return;\n    }\n    files.add(file.getAbsolutePath());\n    server.setCurrentItemResultToOK();\n}"},{"id":"end","implementation":"public void end() throws Exception {\n}"}],"conditionalActionDetails":[{"id":"hasMoreItems","implementation":"public String hasMoreItems() throws Exception {\n    currentItemIndex++;\n    if (currentItemIndex <= numberOfItems) {\n        return \"yes\";\n    }\n    return \"no\";\n}"}]}